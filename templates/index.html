{% extends "base.html" %}
{% block content %}
<form action="/spin" method="get" class="input-group mb-4" style="max-width:400px;margin:auto;">
  <input name="zipcode" class="form-control" placeholder="Enter Zip Code..." required>
  <button class="btn btn-success" type="submit">Spin for Restaurant</button>
</form>
<div class="row mb-4">
  <div class="col-md-8 mx-auto">
    <form action="/search" class="input-group mb-4">
      <input name="q" class="form-control" placeholder="Search restaurant, plate, category, address, city, state, zipcode..." value="{{search or ''}}">
      <button class="btn btn-primary" type="submit">Search</button>
    </form>
  </div>
</div>
<div class="row">
  {% for plate in plates %}
    <div class="col-md-6 col-lg-4 mb-4">
      <div class="card shadow-sm h-100">
        {% if plate['photo'] %}
          <img src="{{ url_for('static', filename='uploads/' ~ plate['photo']) }}" class="card-img-top" alt="Plate photo">
        {% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ plate['restaurant'] }}</h5>
          <h6 class="card-subtitle mb-2 text-muted">{{ plate['plate'] }}</h6>
          <p class="mb-1"><span class="fw-bold">Category:</span> {{ plate['category'] }}</p>
          <p class="mb-1"><span class="fw-bold">Address:</span> {{ plate['address'] }}</p>
          <p class="mb-1">
            <span class="fw-bold">City:</span> {{ plate['city'] }},
            <span class="fw-bold">State:</span> {{ plate['state'] }},
            <span class="fw-bold">Zip:</span> {{ plate['zipcode'] }}
          </p>
          <form action="{{ url_for('favorite', plate_id=plate['id']) }}" method="post" style="display:inline;">
            {% if session.get('user_id') %}
              <button type="submit" class="btn btn-outline-danger btn-sm mb-2">❤️ Add to My Next Meal</button>
            {% endif %}
          </form>
          {% if plate['latitude'] and plate['longitude'] %}
            <p class="mb-1"><span class="fw-bold">Location:</span>
              <a href="https://www.google.com/maps/search/?api=1&query={{ plate['latitude'] }},{{ plate['longitude'] }}" target="_blank">
                ({{ plate['latitude'] }}, {{ plate['longitude'] }})
              </a>
            </p>
          {% endif %}
          <div class="mb-1">
            {% for i in range(1,6) %}
              {% if i <= plate['rating']|int %}
                <span class="star text-warning">&#9733;</span>
              {% else %}
                <span class="star text-secondary">&#9733;</span>
              {% endif %}
            {% endfor %}
            <span class="ms-2 text-muted">[{{ plate['rating'] }} / 5]</span>
          </div>
          <p class="card-text">{{ plate['comment'] }}</p>
        </div>
      </div>
    </div>
  {% else %}
    <div class="col-12"><div class="alert alert-info">No plates found.</div></div>
  {% endfor %}
</div>
{% endblock %}