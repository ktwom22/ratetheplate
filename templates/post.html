{% extends "base.html" %}
{% block content %}
<h2>Post a Plate</h2>
<form method="post" enctype="multipart/form-data">
  <div class="mb-3">
    <label for="photo" class="form-label">Upload Photo</label>
    <input type="file" id="photo" name="photo" accept="image/*" class="form-control" onchange="loadImage(event)">
  </div>
  <div id="image-editor" style="width: 700px; height: 500px;"></div>
  <input type="hidden" name="edited_photo" id="edited_photo">
  <div class="mb-3">
    <label for="hashtags" class="form-label">Hashtags</label>
    <input type="text" id="hashtags" name="hashtags" class="form-control" placeholder="#yummy #spicy #vegan">
  </div>
  <!-- Add other form fields here -->
  <button class="btn btn-primary" onclick="saveEditedPhoto()" type="submit">Post Plate</button>
</form>
<!-- Toast UI Image Editor Scripts -->
<link rel="stylesheet" href="https://uicdn.toast.com/tui-image-editor/latest/tui-image-editor.min.css">
<script src="https://uicdn.toast.com/tui-image-editor/latest/tui-image-editor.min.js"></script>
<script>
  let imageEditor;
  function loadImage(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        if (!imageEditor) {
          imageEditor = new tui.ImageEditor(document.querySelector('#image-editor'), {
            includeUI: {
              loadImage: {path: e.target.result, name: file.name},
              theme: {},
              menu: ['shape', 'icon', 'text', 'mask', 'filter'],
              initMenu: '',
              uiSize: {width: 700, height: 500},
              menuBarPosition: 'bottom'
            },
            cssMaxWidth: 700,
            cssMaxHeight: 500,
          });
        } else {
          imageEditor.loadImageFromURL(e.target.result, file.name).then(() => imageEditor.clearUndoStack());
        }
      };
      reader.readAsDataURL(file);
    }
  }
  function saveEditedPhoto() {
    if (imageEditor) {
      const dataURL = imageEditor.toDataURL();
      document.getElementById('edited_photo').value = dataURL;
    }
  }
</script>
{% endblock %}